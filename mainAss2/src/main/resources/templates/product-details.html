<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Product Details</title>
    <!-- Add your CSS links here -->
</head>
<script th:inline="javascript">
    function submitForm() {
        var orderId = /*[[${orderId}]]*/ 'defaultOrderId'; // Replace with your orderId
        var numItem = document.getElementById('numItem').value; // Assuming you have an input for numItem

        // AJAX request
        fetch('/cart/add/' + orderId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'numItem=' + numItem
        })
        .then(response => response.text())
        .then(data => {
            alert(data); // Show an alert with the response message
        })
        .catch((error) => {
            console.error('Error:', error);
        });

        return false; // Prevent form from submitting the traditional way
    }
</script>
<body>

<div th:if="${product != null}">
    <h1 th:text="${product.brand} + ' ' + ${product.type}">Product Brand and Type</h1>
    <p><strong>Description:</strong> <span th:text="${product.description}">Product Description</span></p>
    <p><strong>Category:</strong> <span th:text="${product.category}">Product Category</span></p>
    <p><strong>Availability:</strong> <span th:text="${product.availability ? 'Available' : 'Unavailable'}">Availability</span></p>
</div>

<div th:unless="${product != null}">
    <p>Product not found.</p>
</div>
<h2>Select Options</h2>
    <form th:action="@{'/cart/add/' + ${orderId}}" method="post">
    <input type="hidden" name="productId" th:value="${product.id}" />

    <label for="color">Color:</label>
    <select name="color" id="color">
        <option th:each="color : ${availableColors}" th:value="${color}" th:text="${color}">Color</option>
    </select>

    <label for="size">Size:</label>
    <select name="size" id="size">
        <option th:each="size : ${availableSizes}" th:value="${size}" th:text="${size}">Size</option>
    </select>

    <p><strong>Price Range:</strong> <span th:text="${priceRange[0] == priceRange[1] ? '$' + priceRange[0] : '$' + priceRange[0] + ' - $' + priceRange[1]}">Price Range</span></p>

    <button type="submit">Add to Cart</button>
</form>
    <div th:if="${not #lists.isEmpty(feedbacks)}">
        <h2>Feedback</h2>
        <ul>
            <li th:each="feedback : ${feedbacks}">
                <p th:text="${feedback.feedbackMessage}">Feedback message</p>
                <div th:if="${feedback.user.username == username}">
                    <a th:href="@{/feedback/update/{id}(id=${feedback.feedbackId})}" class="btn btn-primary">Edit</a>
                    <a th:href="@{/feedback/delete/{feedbackId}(feedbackId=${feedback.feedbackId})}" class="btn btn-danger">Delete Feedback</a>
            </li>
        </ul>
    </div>
    <div>
        <p>Session User: <span th:text="${username}"></span></p>
    </div>
    <div th:unless="${not #lists.isEmpty(feedbacks)}">
        <p>No feedback available for this product.</p>
    </div>
    <!-- Add Feedback Form -->
    <h2>Submit Your Feedback</h2>
    <form th:action="@{/feedback/add}" method="post">
    <input type="hidden" name="productId" th:value="${product.id}" />
    <input type="hidden" name="userId" th:value="${userId}" />

    <label for="feedbackMessage">Your Feedback:</label>
    <textarea name="feedbackMessage" id="feedbackMessage" required></textarea>

    <label for="rating">Rating:</label>
    <select name="rating" id="rating" required>
        <option value="">Select a rating</option>
        <option value="1">1 - Poor</option>
        <option value="2">2 - Fair</option>
        <option value="3">3 - Good</option>
        <option value="4">4 - Very Good</option>
        <option value="5">5 - Excellent</option>
    </select>

    <button type="submit">Submit Feedback</button>
</form>
</body>
</html>
