<!DOCTYPE html>
<html>
<head>
    <title>User Profile</title>
    <!-- Add any required CSS or JS files here -->
</head>
<body>
    <h2>User Profile</h2>
    <form action="/updateProfile" method="post">
        <!-- Hidden field for user ID -->
        <input type="hidden" name="id" th:value="${user.id}" />

        <!-- Name field -->
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" th:value="${user.name}" required /><br>

        <!-- Username field (non-editable) -->
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" th:value="${user.username}" readonly /><br>

        <!-- Email field -->
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" th:value="${user.email}" required /><br>

        <!-- Password field (consider handling separately for security) -->
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required /><br>

        <!-- Address field -->
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" th:value="${user.address}" /><br>

        <!-- Phone field -->
        <label for="phone">Phone:</label>
        <input type="text" id="phone" name="phone" th:value="${user.phone}" /><br>

        <!-- Role field (non-editable) -->
        <label for="role">Role:</label>
        <input type="text" id="role" name="role" th:value="${user.role}" readonly /><br>

        <!-- Status field (non-editable) -->
        <label for="status">Status:</label>
        <input type="text" id="status" name="status" th:value="${user.status}" readonly /><br>

        <!-- Update button -->
        <button type="submit">Update Profile</button>
        <button id="deleteProfileButton">Delete Profile</button>
    </form>
</body>
</html>

<script>
document.getElementById('updateUserForm').addEventListener('submit', function(event) {
    event.preventDefault();
    var userId = /*[[${userId}]]*/ 'defaultUserId'; // Replace with dynamic userId from the server

    var updatedDetails = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        address: document.getElementById('address').value,
        phone: document.getElementById('phone').value,
        // Role and Status are not included as they are typically not editable by the user
    };

    fetch('/users/' + userId, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedDetails)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Success:', data);
        // Handle success - e.g., show a success message, redirect, etc.
    })
    .catch((error) => {
        console.error('Error:', error);
        // Handle errors - e.g., show error message
    });
});
</script>

<script>
    document.getElementById('deleteProfileButton').addEventListener('click', function() {
        if (confirm('Are you sure you want to delete your profile? This action cannot be undone.')) {
            fetch('/deleteProfile', {
                method: 'DELETE'
            })
            .then(response => {
                if(response.ok) {
                    // Handle successful deletion, maybe redirect to the homepage or login page
                    window.location.href = '/signin';
                } else {
                    // Handle errors
                    console.error('HTTP Error:', response.statusText);
                    alert('There was an error deleting your profile.');
                }
            })
            .catch(error => {
            // Handle network errors
            console.error('Network Error:', error);
            alert('Network error occurred. Please try again.');
            });
        }
    });
</script>
